<!DOCTYPE html>
<html lang="en">

<head>
  <!-- Website mata -->
<meta charset="UTF-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />

<!-- Disable transformation -->
<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">

<!-- Website description -->

<meta name="description" content="Git 常用操作指南" />


<!-- Website keywords -->

<meta name="keywords" content="Git, Draco&#39;s Blog" />




<!-- Website rss -->

<link rel="alternate" href="/atom.xml" title="Draco's Blog" type="application/atom+xml">


<!-- Website favicon -->

<link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=3.0.0" />


<!-- Canonical, good for google search engine -->
<link rel="canonical" href="https://stardustorz.github.io/2021/06/12/Basic/git常用操作/" />

<!-- Fancybox styling -->

<link rel="stylesheet" type="text/css" href="/lib/fancybox/jquery.fancybox.css" />


<!-- MathJax (LaTeX) support -->


<!-- Theme styling -->
<link rel="stylesheet" type="text/css" href="/css/style.css?v=3.0.0" />

<!-- Analytics and push -->



  



<!-- LeanCloud Counter -->


<script>
  window.config = {"leancloud":{"app_id":null,"app_key":null,"server_url":null,"cdn":null},"toc":true,"fancybox":true,"latex":false};
</script>
  
  <title>Git 常用操作 - Draco&#39;s Blog</title>

<meta name="generator" content="Hexo 6.3.0"></head>

<body>
  <div class="scrollPercentage"></div>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/." class="logo">Draco&#39;s Blog</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>

<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    
    <a href="/">
      <li class="mobile-menu-item">
        
        
        Home              </li>
    </a>
    
    <a href="/archives/">
      <li class="mobile-menu-item">
        
        
        Archives              </li>
    </a>
    
    <a href="/tags/">
      <li class="mobile-menu-item">
        
        
        Tags              </li>
    </a>
    
    <a href="/categories/">
      <li class="mobile-menu-item">
        
        
        Categories              </li>
    </a>
    
    <a href="/links/">
      <li class="mobile-menu-item">
        
        
        Links              </li>
    </a>
    
    <a href="/about/">
      <li class="mobile-menu-item">
        
        
        About              </li>
    </a>
    
  </ul>
</nav>
  <div class="container" id="mobile-panel">
    <header id="header" class="header">
      <div class="logo-wrapper">  
  <a href="/." class="logo">Draco's Blog</a>  
</div>  
  
<nav class="site-navbar">  
    
    <ul id="menu" class="menu">  
        
        <li class="menu-item">  
          <a class="menu-item-link" href="/">  
              
              
              Home  
              
          </a>  
        </li>  
        
        <li class="menu-item">  
          <a class="menu-item-link" href="/archives/">  
              
              
              Archives  
              
          </a>  
        </li>  
        
        <li class="menu-item">  
          <a class="menu-item-link" href="/tags/">  
              
              
              Tags  
              
          </a>  
        </li>  
        
        <li class="menu-item">  
          <a class="menu-item-link" href="/categories/">  
              
              
              Categories  
              
          </a>  
        </li>  
        
        <li class="menu-item">  
          <a class="menu-item-link" href="/links/">  
              
              
              Links  
              
          </a>  
        </li>  
        
        <li class="menu-item">  
          <a class="menu-item-link" href="/about/">  
              
              
              About  
              
          </a>  
        </li>  
        
    </ul>  
    
</nav>  

    </header>
    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
  <header class="post-header">
    <h1 class="post-title">
      
      Git 常用操作
      
    </h1>

    <div class="post-meta">
      <span class="post-time">
        2021-06-12
      </span>
      
      
      <span class="post-category">
        
        <a href="/categories/Basic/">Basic</a>
        
      </span>
      
      
    </div>
  </header>

  
  <div class="post-toc" id="post-toc">
    <h2 class="post-toc-title">Contents</h2>
    <div class="post-toc-content">
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%80%E3%80%81git-%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B"><span class="toc-number">1.</span> <span class="toc-text">一、git 工作流程</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%8C%E3%80%81git-%E5%88%9D%E5%A7%8B%E5%8C%96"><span class="toc-number">2.</span> <span class="toc-text">二、git 初始化</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%89%E3%80%81git-%E9%85%8D%E7%BD%AE%E7%9B%B8%E5%85%B3%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4"><span class="toc-number">3.</span> <span class="toc-text">三、git 配置相关常用命令</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-git-config"><span class="toc-number">3.1.</span> <span class="toc-text">1 git config</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%9B%9B%E3%80%81git-%E6%97%A5%E5%B8%B8%E6%93%8D%E4%BD%9C"><span class="toc-number">4.</span> <span class="toc-text">四、git 日常操作</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E6%8F%90%E4%BA%A4%E4%BB%A3%E7%A0%81"><span class="toc-number">4.1.</span> <span class="toc-text">1 提交代码</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-git-add"><span class="toc-number">4.1.1.</span> <span class="toc-text">1.1 git add</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-git-status"><span class="toc-number">4.1.2.</span> <span class="toc-text">1.2 git status</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-git-diff"><span class="toc-number">4.1.3.</span> <span class="toc-text">1.3 git diff</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-4-git-ls-files"><span class="toc-number">4.1.4.</span> <span class="toc-text">1.4 git ls-files</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-5-git-cat-file-p"><span class="toc-number">4.1.5.</span> <span class="toc-text">1.5 git cat-file -p</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-6-git-commit"><span class="toc-number">4.1.6.</span> <span class="toc-text">1.6 git commit</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-7-git-rebase"><span class="toc-number">4.1.7.</span> <span class="toc-text">1.7 git rebase</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-8-git-stash"><span class="toc-number">4.1.8.</span> <span class="toc-text">1.8 git stash</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-9-git-rm"><span class="toc-number">4.1.9.</span> <span class="toc-text">1.9 git rm</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E5%88%86%E6%94%AF%E6%93%8D%E4%BD%9C"><span class="toc-number">4.2.</span> <span class="toc-text">2 分支操作</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E6%9B%B4%E6%96%B0%E6%93%8D%E4%BD%9C"><span class="toc-number">4.3.</span> <span class="toc-text">3 更新操作</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-%E5%90%88%E5%B9%B6%E5%86%B2%E7%AA%81"><span class="toc-number">4.4.</span> <span class="toc-text">4 合并冲突</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-%E6%9A%82%E5%AD%98%E4%BB%A3%E7%A0%81%E4%BF%9D%E6%8A%A4%E7%8E%B0%E5%9C%BA"><span class="toc-number">4.5.</span> <span class="toc-text">5 暂存代码保护现场</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%94%E3%80%81git-%E9%AB%98%E7%BA%A7%E6%93%8D%E4%BD%9C"><span class="toc-number">5.</span> <span class="toc-text">五、git 高级操作</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-git-%E6%92%A4%E9%94%80%E6%93%8D%E4%BD%9C"><span class="toc-number">5.1.</span> <span class="toc-text">1 git 撤销操作</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-git-%E6%89%BE%E5%9B%9E%E4%B8%A2%E5%A4%B1%E6%96%87%E4%BB%B6-commit%E4%BA%86"><span class="toc-number">5.2.</span> <span class="toc-text">2 git 找回丢失文件(commit了)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-git-%E6%89%BE%E5%9B%9E%E4%B8%A2%E5%A4%B1%E6%96%87%E4%BB%B6-%E6%9C%AAcommit-%E4%BD%86%E6%B7%BB%E5%8A%A0%E6%9A%82%E5%AD%98%E5%8C%BA%E4%BA%86"><span class="toc-number">5.3.</span> <span class="toc-text">3 git 找回丢失文件(未commit,但添加暂存区了)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-%E7%BB%88%E6%9E%81%E5%A4%A7%E6%8B%9B"><span class="toc-number">5.4.</span> <span class="toc-text">4 终极大招</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-git-%E8%BF%81%E7%A7%BB-%E4%BF%9D%E7%95%99-commit"><span class="toc-number">5.5.</span> <span class="toc-text">5 git 迁移(保留 commit)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-1-clone-%E5%8E%9F%E6%9D%A5%E7%9A%84%E9%A1%B9%E7%9B%AE"><span class="toc-number">5.5.1.</span> <span class="toc-text">5.1 clone 原来的项目</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2-%E6%8E%A8%E9%80%81%E5%88%B0%E6%96%B0%E7%9A%84gitlab"><span class="toc-number">5.5.2.</span> <span class="toc-text">5.2 推送到新的gitlab</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-3-%E6%9C%AC%E5%9C%B0%E4%BB%A3%E7%A0%81%E6%9B%B4%E6%8D%A2gitlab%E5%9C%B0%E5%9D%80"><span class="toc-number">5.5.3.</span> <span class="toc-text">5.3 本地代码更换gitlab地址</span></a></li></ol></li></ol></li></ol>
    </div>
  </div>
  

  <div class="post-content">
    
    <h1 id="一、git-工作流程"><a href="#一、git-工作流程" class="headerlink" title="一、git 工作流程"></a>一、git 工作流程</h1><p>git 有四个区域:</p>
<ul>
<li>3个本地区域<ul>
<li>工作区(Workspace): 存放项目代码的地方。</li>
<li>暂存区(Stage): 存放临时的改动, 事实上它只是一个文件, 保存即将提交的文件列表信息。</li>
<li>资源库(Repository): 安全存放数据的位置, 这里面有提交到所有版本的数据。其中 HEAD 指向最新放入仓库的版本。</li>
</ul>
</li>
<li>1个远程区域<ul>
<li>远程库(Remote): 托管代码的服务器。</li>
</ul>
</li>
</ul>
<p><img src="../../img/git/git区域.png" alt="git区域"></p>
<h1 id="二、git-初始化"><a href="#二、git-初始化" class="headerlink" title="二、git 初始化"></a>二、git 初始化</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">mkdir</span> git-study &amp;&amp; <span class="built_in">cd</span> git-study</span><br><span class="line">$ git init</span><br><span class="line">$ <span class="built_in">ls</span> -la</span><br><span class="line">total 0</span><br><span class="line">drwxr-xr-x   3 kino  staff   96 11 23 17:18 .</span><br><span class="line">drwxr-xr-x  16 kino  staff  512 11 23 17:18 ..</span><br><span class="line">drwxr-xr-x   9 kino  staff  288 11 23 17:18 .git</span><br></pre></td></tr></table></figure>
<p>创建成功之后, 会出现一个 <code>.git</code> 的隐藏文件夹, 这个就是这个项目的 git 仓库, 以后所有的 git 操作历史提交记录信息全都在此, 只要这个文件夹还存在, 就可以记住我们所有的 git 操作。</p>
<h1 id="三、git-配置相关常用命令"><a href="#三、git-配置相关常用命令" class="headerlink" title="三、git 配置相关常用命令"></a>三、git 配置相关常用命令</h1><h2 id="1-git-config"><a href="#1-git-config" class="headerlink" title="1 git config"></a>1 git config</h2><p>查看 git 配置<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ git config --list</span><br><span class="line">credential.helper=osxkeychain</span><br><span class="line">user.name=kino</span><br><span class="line">user.email=kino@gmail.com</span><br><span class="line">core.autocrlf=input</span><br><span class="line">core.quotepath=<span class="literal">false</span></span><br><span class="line">core.repositoryformatversion=0</span><br><span class="line">core.filemode=<span class="literal">true</span></span><br><span class="line">core.bare=<span class="literal">false</span></span><br><span class="line">core.logallrefupdates=<span class="literal">true</span></span><br><span class="line">core.ignorecase=<span class="literal">true</span></span><br><span class="line">core.precomposeunicode=<span class="literal">true</span></span><br></pre></td></tr></table></figure><br>修改 git 配置文件<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git config -e            <span class="comment"># 针对当前仓库</span></span><br><span class="line">$ git config -e --global   <span class="comment"># 针对系统上的所有仓库</span></span><br></pre></td></tr></table></figure><br>设置提交代码时的用户信息<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git config --global user.name <span class="string">&quot;yourUserName&quot;</span>     <span class="comment"># 去掉 --global 就只对当前仓库生效</span></span><br><span class="line">$ git config --gloabl user.email <span class="string">&quot;yourEmail&quot;</span>       <span class="comment"># 去掉 --global 就只对当前仓库生效</span></span><br></pre></td></tr></table></figure></p>
<h1 id="四、git-日常操作"><a href="#四、git-日常操作" class="headerlink" title="四、git 日常操作"></a>四、git 日常操作</h1><p><a href="#411-git-add"><code>git add</code>: 将文件添加到暂存区</a></p>
<p><a href="#412-git-status"><code>git status</code>: 查看在你上次提交之后是否有对文件进行再次修改</a></p>
<p><a href="#413-git-diff"><code>git diff</code>: 比较文件在暂存区和工作区的差异</a></p>
<p><a href="#414-git-status"><code>git ls-files</code>: 查看暂存区的文件</a></p>
<p><a href="#415-git-status"><code>git cat-file -p</code>: 查看暂存区文件中的内容</a></p>
<p><a href="#416-git-status"><code>git commit</code>: 提交暂存区文件到本地仓库</a></p>
<p><a href="#417-git-rm"><code>git rm</code>: 删除文件</a></p>
<h2 id="1-提交代码"><a href="#1-提交代码" class="headerlink" title="1 提交代码"></a>1 提交代码</h2><h3 id="1-1-git-add"><a href="#1-1-git-add" class="headerlink" title="1.1 git add"></a>1.1 git add</h3><p>语法:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. 该命令可以将文件添加到暂存区</span></span><br><span class="line">$ git add [file1] [file2] ...</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 添加指定目录到暂存区</span></span><br><span class="line">$ git add [<span class="built_in">dir</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 添加当前目录下所有文件进入暂存区</span></span><br><span class="line">$ git add .</span><br></pre></td></tr></table></figure><br>示例:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">touch</span> 1.txt 2.txt 3.txt 4.txt</span><br><span class="line">$ ll </span><br><span class="line">total 8</span><br><span class="line">-rw-r--r--  1 kino  staff   0  7  5 18:30 1.txt</span><br><span class="line">-rw-r--r--  1 kino  staff   0  7  5 18:30 2.txt</span><br><span class="line">-rw-r--r--  1 kino  staff   0  7  5 18:31 3.txt</span><br><span class="line">-rw-r--r--  1 kino  staff   0  7  5 18:31 4.txt</span><br><span class="line">-rw-r--r--  1 kino  staff  13  7  5 18:30 README.md</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加 1.txt 和 2.txt 进入暂存区</span></span><br><span class="line">$ git add 1.txt 2.txt</span><br></pre></td></tr></table></figure></p>
<h3 id="1-2-git-status"><a href="#1-2-git-status" class="headerlink" title="1.2 git status"></a>1.2 git status</h3><p>查看在你上次提交之后是否有对文件进行再次修改。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">$ git status </span><br><span class="line">On branch main</span><br><span class="line">Your branch is up to <span class="built_in">date</span> with <span class="string">&#x27;origin/main&#x27;</span>.</span><br><span class="line"></span><br><span class="line">Changes to be committed:</span><br><span class="line">  (use <span class="string">&quot;git restore --staged &lt;file&gt;...&quot;</span> to unstage)</span><br><span class="line">	new file:   1.txt</span><br><span class="line">	new file:   2.txt</span><br><span class="line"></span><br><span class="line">Untracked files:</span><br><span class="line">  (use <span class="string">&quot;git add &lt;file&gt;...&quot;</span> to include <span class="keyword">in</span> what will be committed)</span><br><span class="line">	3.txt</span><br><span class="line">	4.txt</span><br><span class="line"></span><br><span class="line">$ git status -s </span><br><span class="line">A  1.txt</span><br><span class="line">A  2.txt</span><br><span class="line">?? 3.txt</span><br><span class="line">?? 4.txt</span><br><span class="line"></span><br><span class="line">$ git commit -m <span class="string">&quot;提交&quot;</span></span><br><span class="line">[main 26c1139] 提交</span><br><span class="line"> 2 files changed, 0 insertions(+), 0 deletions(-)</span><br><span class="line"> create mode 100644 1.txt</span><br><span class="line"> create mode 100644 2.txt</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">echo</span> 11111 &gt;&gt; 1.txt</span><br><span class="line">$ <span class="built_in">echo</span> 33333 &gt;&gt; 3.txt</span><br><span class="line">$ git add 3.txt</span><br><span class="line"></span><br><span class="line">$ git status -s </span><br><span class="line"> M 1.txt</span><br><span class="line">AM 3.txt</span><br><span class="line">?? 4.txt</span><br></pre></td></tr></table></figure></p>
<ul>
<li>A 表示新提交</li>
<li>M 表示提交过，并且本地又修改了</li>
<li>AM 表示有改动</li>
</ul>
<h3 id="1-3-git-diff"><a href="#1-3-git-diff" class="headerlink" title="1.3 git diff"></a>1.3 git diff</h3><p>比较文件的不同, 即比较文件在暂存区和工作区的差异</p>
<p>git diff 显示已经写入暂存区和已经被修改但尚未写入暂存区文件的区别</p>
<p>应用场景:</p>
<ol>
<li>尚未缓存的改动: git diff</li>
<li>查看已经缓存的改动: git diff —cached</li>
<li>查看缓存成功和未缓存的所有改动: git diff HEAD</li>
<li>显示摘要而非整个diff: git diff —stat</li>
</ol>
<p>删除原来的项目重新clone<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">rm</span> -rf git-study</span><br><span class="line">$ git init</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">cd</span> git-study</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">echo</span> 1111 &gt;&gt; README.md</span><br><span class="line">$ git add . &amp;&amp; git commit -m <span class="string">&quot;readme&quot;</span> </span><br><span class="line">$ <span class="built_in">echo</span> 2222 &gt;&gt; README.md</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看暂未添加至缓存区的改动</span></span><br><span class="line">$ git diff</span><br><span class="line">diff --git a/README.md b/README.md</span><br><span class="line">index 5f2f16b..4f142ee 100644</span><br><span class="line">--- a/README.md</span><br><span class="line">+++ b/README.md</span><br><span class="line">@@ -1 +1,2 @@</span><br><span class="line"> 1111</span><br><span class="line">+2222</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示简略信息</span></span><br><span class="line">$ git diff --<span class="built_in">stat</span></span><br><span class="line"> README.md | 1 +</span><br><span class="line"> 1 file changed, 1 insertion(+)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看已经添加至缓存区的改动</span></span><br><span class="line">$ git add README.md</span><br><span class="line">$ git diff --cached</span><br><span class="line">diff --git a/README.md b/README.md</span><br><span class="line">index 5f2f16b..4f142ee 100644</span><br><span class="line">--- a/README.md</span><br><span class="line">+++ b/README.md</span><br><span class="line">@@ -1 +1,2 @@</span><br><span class="line"> 1111</span><br><span class="line">+2222</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看不在缓存区 &amp; 在缓存区的改动</span></span><br><span class="line">$ git diff HEAD</span><br><span class="line">diff --git a/README.md b/README.md</span><br><span class="line">index 5f2f16b..4f142ee 100644</span><br><span class="line">--- a/README.md</span><br><span class="line">+++ b/README.md</span><br><span class="line">@@ -1 +1,2 @@</span><br><span class="line"> 1111</span><br><span class="line">+2222</span><br></pre></td></tr></table></figure></p>
<h3 id="1-4-git-ls-files"><a href="#1-4-git-ls-files" class="headerlink" title="1.4 git ls-files"></a>1.4 git ls-files</h3><p>查看暂存区的文件<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git ls-files</span><br><span class="line">README.md</span><br></pre></td></tr></table></figure><br>可选参数:</p>
<ul>
<li>-c: 默认</li>
<li>-d: 显示删除的文件</li>
<li>-m: 显示被修改过的文件</li>
<li>-o: 显示没有被 git 跟踪过的文件</li>
<li>-s: 显示 mode 以及对应的 Blog对象, 进而可以获取暂存区中对应文件的内容</li>
</ul>
<h3 id="1-5-git-cat-file-p"><a href="#1-5-git-cat-file-p" class="headerlink" title="1.5 git cat-file -p"></a>1.5 git cat-file -p</h3><p>查看暂存区文件中的内容<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ git ls-files -s</span><br><span class="line">100644 5cf7833392d65968a05971b9923f36a1ec46d7f7 0       README.md</span><br><span class="line"></span><br><span class="line">$ git cat-file -p  5cf7</span><br><span class="line">1111</span><br><span class="line">2222</span><br></pre></td></tr></table></figure></p>
<h3 id="1-6-git-commit"><a href="#1-6-git-commit" class="headerlink" title="1.6 git commit"></a>1.6 git commit</h3><p>提交暂存区文件到本地仓库<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git commit -m [message]</span><br></pre></td></tr></table></figure><br>提交暂存区的指定文件到本地仓库<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git commit [file1] [file2] ... -m [message]</span><br></pre></td></tr></table></figure></p>
<h3 id="1-7-git-rebase"><a href="#1-7-git-rebase" class="headerlink" title="1.7 git rebase"></a>1.7 git rebase</h3><ul>
<li>变基提交,用来重写提交历史</li>
<li>基于 master 的 a 新建的分支,后面 master 又有了 c 提交,rebase 后分支的更新就是基于 c 了<h3 id="1-8-git-stash"><a href="#1-8-git-stash" class="headerlink" title="1.8 git stash"></a>1.8 git stash</h3></li>
<li>保存当前工作进度，会把暂存区和工作区的改动保存到一个未完结变更的堆栈中；执行完这个命令后，在运行 <code>git status</code> 命令，就会发现当前是一个干净的工作区，没有任何改动<h3 id="1-9-git-rm"><a href="#1-9-git-rm" class="headerlink" title="1.9 git rm"></a>1.9 git rm</h3><code>git rm</code> 用于删除文件</li>
</ul>
<p>1、将文件从暂存区和工作区中删除<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">rm</span> 1.txt 2.txt</span><br></pre></td></tr></table></figure><br>2、将文件从暂存区和工作区中强制删除<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 可以加上 -f, 表示强制删除之前修改过而且 add 到暂存区的文件</span></span><br><span class="line">$ git <span class="built_in">rm</span> -f 1.txt 2.txt</span><br></pre></td></tr></table></figure><br>3、将文件从暂存区删除，在工作区保留<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">rm</span> --cached 1.txt 2.txt</span><br></pre></td></tr></table></figure></p>
<h2 id="2-分支操作"><a href="#2-分支操作" class="headerlink" title="2 分支操作"></a>2 分支操作</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看分支</span></span><br><span class="line">$ git branch -a </span><br><span class="line"></span><br><span class="line"><span class="comment"># 基于当前分支创建一个新分支</span></span><br><span class="line">$ git checkout -b feature/hotfix-001</span><br><span class="line"></span><br><span class="line"><span class="comment"># 基于指定分支创建一个新的分支</span></span><br><span class="line">$ git checkout -b feature/hotfix-002 master</span><br><span class="line"></span><br><span class="line"><span class="comment"># 切换分支</span></span><br><span class="line">$ git checkout master</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除分支</span></span><br><span class="line">$ git branch -d feature/hotfix-001</span><br></pre></td></tr></table></figure>
<h2 id="3-更新操作"><a href="#3-更新操作" class="headerlink" title="3 更新操作"></a>3 更新操作</h2><p>@TODO</p>
<h2 id="4-合并冲突"><a href="#4-合并冲突" class="headerlink" title="4 合并冲突"></a>4 合并冲突</h2><p>简单制造一个冲突<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 再迁出一个分支(模拟其他人的修改操作)</span></span><br><span class="line">$ git checkout -b feature/hotfix-001 feature/hotfix-002</span><br><span class="line"><span class="comment"># 修改文件</span></span><br><span class="line">$ <span class="built_in">echo</span> 3333 &gt;&gt; README.md</span><br><span class="line">$ git add README.md</span><br><span class="line">$ git commit -m <span class="string">&quot;hotfix-001: add newline&quot;</span></span><br><span class="line"><span class="comment"># 合并到master</span></span><br><span class="line">$ git checkout master </span><br><span class="line">$ git merge feature/hotfix-001</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$ git checkout feature/hotfix-002</span><br><span class="line">$ vim README.md</span><br><span class="line"><span class="comment"># 在第三行添加</span></span><br><span class="line">3344</span><br><span class="line">$ git add README.md</span><br><span class="line">$ git commit -m <span class="string">&quot;hotfix-002: add newline&quot;</span></span><br><span class="line"></span><br><span class="line">$ git checkout master</span><br><span class="line"><span class="comment"># 再合并代码就会出现冲突提示</span></span><br><span class="line"><span class="comment"># 这个时候不可以进行任何分支切换和commit操作，需要按照提示将冲突解决。</span></span><br><span class="line">$ git merge feature/hotfix-002</span><br><span class="line">Auto-merging README.md</span><br><span class="line">CONFLICT (content): Merge conflict <span class="keyword">in</span> README.md</span><br><span class="line">Automatic merge failed; fix conflicts and <span class="keyword">then</span> commit the result.</span><br></pre></td></tr></table></figure><br>查看冲突文件内容<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ vim README.md</span><br><span class="line">1111</span><br><span class="line">2222</span><br><span class="line">&lt;&lt;&lt;&lt;&lt;&lt;&lt; <span class="string">HEAD</span></span><br><span class="line"><span class="string">3333</span></span><br><span class="line"><span class="string">=======</span></span><br><span class="line"><span class="string">3344</span></span><br><span class="line"><span class="string">&gt;&gt;&gt;&gt;&gt;&gt;&gt; feature/hotfix-002</span></span><br></pre></td></tr></table></figure></p>
<ul>
<li>从 <code>&lt;&lt;&lt;&lt;&lt;&lt;&lt; HEAD</code> 开始, 到 <code>=======</code> 都是主分支已经存在的内容。</li>
<li>从 <code>=======</code> 开始, 到 <code>&gt;&gt;&gt;&gt;&gt;&gt;&gt; feature/hotfix-002</code> 都是 merge 过来的分支的内容。</li>
</ul>
<p>解决冲突，视情况保留(删除)记录<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">$ vim README.md</span><br><span class="line">1111</span><br><span class="line">2222</span><br><span class="line">3333</span><br><span class="line">3344</span><br><span class="line"></span><br><span class="line"><span class="comment"># 冲突解决完成之后, 再次提交代码</span></span><br><span class="line">$ git commit -a</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看变更记录</span></span><br><span class="line">commit 8715c66d8ca756077040ce6d783c6caf470d115e (HEAD -&gt; master)</span><br><span class="line">Merge: b89c0c5 ba903ae</span><br><span class="line">Author: kino &lt;kino@gmail.com&gt;</span><br><span class="line">Date:   Wed Nov 23 18:29:17 2022 +0800</span><br><span class="line"></span><br><span class="line">    Merge branch <span class="string">&#x27;feature/hotfix-002&#x27;</span></span><br><span class="line"></span><br><span class="line">commit ba903aebecb447d6f485108f0321b15f6c009886 (feature/hotfix-002)</span><br><span class="line">Author: kino &lt;kino@gmail.com&gt;</span><br><span class="line">Date:   Wed Nov 23 18:19:54 2022 +0800</span><br><span class="line"></span><br><span class="line">    hotfix-002: add newline</span><br><span class="line"></span><br><span class="line">commit b89c0c592ba11894acb2cd93564c5e43934065fb (feature/hotfix-001)</span><br><span class="line">Author: kino &lt;kino@gmail.com&gt;</span><br><span class="line">Date:   Wed Nov 23 18:16:23 2022 +0800</span><br><span class="line"></span><br><span class="line">    hotfix-001: add newline</span><br></pre></td></tr></table></figure></p>
<h2 id="5-暂存代码保护现场"><a href="#5-暂存代码保护现场" class="headerlink" title="5 暂存代码保护现场"></a>5 暂存代码保护现场</h2><p>项目经理提了一个新的需求, 开发就需要从 master 分支迁出一个新的分支进行功能开发(例如迁出新分支为dev), 如果在开发过程工, 生产上有紧急 bug 需要修复, 就可以用到 <code>git stash</code> 了。</p>
<p><code>git stash</code> 可以将现在的 <strong>工作区</strong>全部的修改、新增、删除等操作，全部保存起来。</p>
<p><code>git stash</code> 的常用命令:</p>
<ol>
<li><code>git stash save &#39;save message&#39;</code>: 执行存储时, 添加备注, 方便查找, 当然只执行 <code>git stash</code> 也是可以的, 但查找时不方便。</li>
<li><code>git stash list</code>: 查看 stash 了哪些存储。</li>
<li><code>git stash show</code>: 显示做了哪些改动, 默认 show 第一个存储, 如果要显示其他的存储, 后面加 <code>stash@&#123;$num&#125;</code>, 比如第二个: <code>git stash show stash@&#123;1&#125;</code></li>
<li><code>git stast show -p</code>: 显示第一个存储的改动, 如果想显示其他存储, 则: <code>git stash show stash@&#123;$num&#125; -p</code>, 比如第二个: <code>git stash show stash@&#123;1&#125; -p</code></li>
<li><code>git stash apply</code>: 应用某个存储, 但不会把存储从存储列表中删除, 默认使用第一个存储, 即 <code>stash@&#123;0&#125;</code>, 如果要是用其他, 则: <code>git stash apply stash@&#123;$num&#125;</code>, 比如第二个: <code>git stash apply stash@&#123;1&#125;</code></li>
<li><code>git stash pop</code>: 恢复之前缓存的工作目录, 将缓存列表中对应的 stash 删除, 并将对应修改应用到当前的工作目录下, 默认为第一个 stash, 即 <code>stash@&#123;0&#125;</code>, 如果要应用并删除其他 stash, 则: <code>git stash pop stash@&#123;$num&#125;</code>, 比如应用并删除第二个: <code>git stash pop stash@&#123;1&#125;</code></li>
<li><code>git stash drop stash@&#123;num&#125;</code>: 丢弃 <code>stash@&#123;num&#125;</code> 存储, 从列表中删除这个存储</li>
<li><code>git stash clear</code>: 删除所有缓存的 stash</li>
</ol>
<p>开始模拟现场<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># git 初始化</span></span><br><span class="line">$ <span class="built_in">cd</span> .. &amp;&amp; <span class="built_in">rm</span> -rf git-study &amp;&amp; <span class="built_in">mkdir</span> git-study &amp;&amp; <span class="built_in">cd</span> git-study &amp;&amp; git init</span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">&#x27;file1 init&#x27;</span> &gt; file1.txt</span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">&#x27;file2 init&#x27;</span> &gt; file2.txt</span><br><span class="line">$ git add .</span><br><span class="line">$ git commit -m <span class="string">&#x27;change: add file1 &amp; file2&#x27;</span></span><br><span class="line">[master (root-commit) 525c358] change: add file1 &amp; file2</span><br><span class="line"> 2 files changed, 2 insertions(+)</span><br><span class="line"> create mode 100644 file1.txt</span><br><span class="line"> create mode 100644 file2.txt</span><br><span class="line"> </span><br><span class="line"><span class="comment"># 然后从 master 分支创建两个新的 feature 分支</span></span><br><span class="line">$ git branch feature1</span><br><span class="line">$ git branch feature2</span><br><span class="line"></span><br><span class="line"><span class="comment"># checkout feature1, 修改 file1.txt, 并在 feature1 上创建两次提交</span></span><br><span class="line">$ git checkout feature1</span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">&#x27;add file1.txt code 1&#x27;</span> &gt;&gt; file1.txt</span><br><span class="line">$ git add file1.txt</span><br><span class="line">$ git commit -m <span class="string">&#x27;change file1 no.1&#x27;</span></span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">&#x27;add file2.txt code 2&#x27;</span> &gt;&gt; file1.txt</span><br><span class="line">$ git add file1.txt</span><br><span class="line">$ git commit -m <span class="string">&#x27;change file1 no.2&#x27;</span></span><br><span class="line"><span class="comment"># 目前 feature1 上的改动内容</span></span><br><span class="line">$ <span class="built_in">cat</span> file1.txt</span><br><span class="line">file1 init</span><br><span class="line">add file1.txt code 1</span><br><span class="line">add file2.txt code 2</span><br><span class="line">$ <span class="built_in">cat</span> file2.txt</span><br><span class="line">file2 init</span><br><span class="line"></span><br><span class="line"><span class="comment"># checkout feature2, 修改 file2.tx</span></span><br><span class="line">$ git checkout feature2</span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">&#x27;add file2.txt code 1&#x27;</span> &gt;&gt; file2.txt</span><br><span class="line">$ git add file2.txt</span><br><span class="line">$ git commit -m <span class="string">&#x27;change file2 no.1&#x27;</span></span><br><span class="line"><span class="comment"># 目前 feature2 上的改动内容</span></span><br><span class="line">$ <span class="built_in">cat</span> file1.txt</span><br><span class="line">file1 init</span><br><span class="line">$ <span class="built_in">cat</span> file2.txt</span><br><span class="line">file2 init</span><br><span class="line">add file2.txt code 1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 假设不小心将 feature2 合并到了 feature1, 并在 feature1 继续进行了代码开发并提交</span></span><br><span class="line">$ git checkout feature1</span><br><span class="line">$ git merge feature2</span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">&#x27;add file1.txt no.3 &amp; code end&#x27;</span> &gt;&gt; file1.txt</span><br><span class="line">$ git add file1.txt</span><br><span class="line">$ git commit -m <span class="string">&#x27;change file1 no.3&#x27;</span></span><br><span class="line"><span class="comment"># 此时 feature1 上所有文件的内容</span></span><br><span class="line">$ <span class="built_in">cat</span> file1.txt</span><br><span class="line">file1 init</span><br><span class="line">add file1.txt code 1</span><br><span class="line">add file2.txt code 2</span><br><span class="line">add file1.txt no.3 &amp; code end</span><br><span class="line">$ <span class="built_in">cat</span> file2.txt</span><br><span class="line">file2 init</span><br><span class="line">add file2.txt code 1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 此时我们发现了不小心 merge 进来的 feature2, 而且在这基础上我们还有新的 commit, 如果我们想将 merge 剔除, 可以做如下操作</span></span><br><span class="line"><span class="comment"># 先查看需要还原 commit 的版本号</span></span><br><span class="line">$ git <span class="built_in">log</span> --oneline</span><br><span class="line">8a1454f (HEAD -&gt; feature1) change file1 no.3</span><br><span class="line">422a454 Merge branch <span class="string">&#x27;feature2&#x27;</span> into feature1</span><br><span class="line">4978e2c (feature2) change file2 no.1</span><br><span class="line">ee4a50e change file1 no.2</span><br><span class="line">dc397c1 change file1 no.1</span><br><span class="line">525c358 (master) change: add file1 &amp; file2</span><br><span class="line"><span class="comment"># 其中, 422a454 就是误合并的 commitid</span></span><br><span class="line"><span class="comment"># 目前我们需要做的就是撤销已提交的 commit, 回滚到 feature2 误合并到 feature1 分支的 commit 版本。</span></span><br><span class="line">$ git reset --mixed 422a454</span><br><span class="line">Unstaged changes after reset:</span><br><span class="line">M	file1.txt</span><br><span class="line">$ git <span class="built_in">log</span> --oneline</span><br><span class="line">422a454 (HEAD -&gt; feature1) Merge branch <span class="string">&#x27;feature2&#x27;</span> into feature1</span><br><span class="line">4978e2c (feature2) change file2 no.1</span><br><span class="line">ee4a50e change file1 no.2</span><br><span class="line">dc397c1 change file1 no.1</span><br><span class="line">525c358 (master) change: add file1 &amp; file2</span><br><span class="line">$ git diff file1.txt</span><br><span class="line">diff --git a/file1.txt b/file1.txt</span><br><span class="line">index 4a1ca46..6954af7 100644</span><br><span class="line">--- a/file1.txt</span><br><span class="line">+++ b/file1.txt</span><br><span class="line">@@ -1,3 +1,4 @@</span><br><span class="line"> file1 init</span><br><span class="line"> add file1.txt code 1</span><br><span class="line"> add file2.txt code 2</span><br><span class="line">+add file1.txt no.3 &amp; code end   <span class="comment">## 可以看见, feature1 最后一次提交已经是未暂存状态了</span></span><br><span class="line"><span class="comment"># 此时, 我们就可以使用 git stash, 将撤销的代码存储起来, </span></span><br><span class="line">$ git stash save <span class="string">&#x27;save file1.txt reset code&#x27;</span></span><br><span class="line">Saved working directory and index state On feature1: save file1.txt reset code</span><br><span class="line"><span class="comment"># 查看 stash 列表</span></span><br><span class="line">$ git stash list</span><br><span class="line">stash@&#123;0&#125;: On feature1: save file1.txt reset code</span><br><span class="line"><span class="comment"># 查看 status, 可以看见在工作空间已经没有了</span></span><br><span class="line">$ git status </span><br><span class="line">On branch feature1</span><br><span class="line">nothing to commit, working tree clean</span><br><span class="line"></span><br><span class="line"><span class="comment"># 然后再撤销 merge 相关的信息</span></span><br><span class="line">$ git reset --hard HEAD~</span><br><span class="line"><span class="comment"># 再查看此时本地的文件内容</span></span><br><span class="line">$ <span class="built_in">cat</span> file1.txt</span><br><span class="line">file1 init</span><br><span class="line">add file1.txt code 1</span><br><span class="line">add file2.txt code 2</span><br><span class="line">$ <span class="built_in">cat</span> file2.txt</span><br><span class="line">file2 init</span><br><span class="line"></span><br><span class="line"><span class="comment"># 接下来恢复 feature1 上被撤销的代码</span></span><br><span class="line">$ git stash list</span><br><span class="line">stash@&#123;0&#125;: On feature1: save file1.txt reset code</span><br><span class="line">$ git stash apply stash&#123;0&#125;</span><br><span class="line">On branch feature1</span><br><span class="line">Changes not staged <span class="keyword">for</span> commit:</span><br><span class="line">  (use <span class="string">&quot;git add &lt;file&gt;...&quot;</span> to update what will be committed)</span><br><span class="line">  (use <span class="string">&quot;git restore &lt;file&gt;...&quot;</span> to discard changes <span class="keyword">in</span> working directory)</span><br><span class="line">	modified:   file1.txt</span><br><span class="line"></span><br><span class="line">no changes added to commit (use <span class="string">&quot;git add&quot;</span> and/or <span class="string">&quot;git commit -a&quot;</span>)</span><br><span class="line"><span class="comment"># 此时代码就恢复回来了</span></span><br><span class="line">$ <span class="built_in">cat</span> file1.txt</span><br><span class="line">file1 init</span><br><span class="line">add file1.txt code 1</span><br><span class="line">add file2.txt code 2</span><br><span class="line">add file1.txt no.3 &amp; code end</span><br></pre></td></tr></table></figure><br>说明: git stash会贮存及不会贮存的文件范围</p>
<ul>
<li>会贮存: <ul>
<li>添加到暂存区的修改（staged changes）</li>
<li>git跟踪的但并未添加到暂存区的修改（unstaged changes）</li>
</ul>
</li>
<li>不会贮存:<ul>
<li>在工作目录中新的文件（untracked files）</li>
<li>被忽略的文件（ignored files）</li>
</ul>
</li>
</ul>
<p>当然, 如果仅仅需要 删除某个 commit, 其实有更好的方法<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 假设, 当前已经到了 git commit -m &#x27;change file1 no.3&#x27;, 当前 log </span></span><br><span class="line">$ git <span class="built_in">log</span></span><br><span class="line">commit 3e6be928866581f1779bb0f0e84d29d068d698e8 (HEAD -&gt; feature1)</span><br><span class="line">Author: kino &lt;kino@gmail.com&gt;</span><br><span class="line">Date:   Thu Nov 24 23:30:31 2022 +0800</span><br><span class="line"></span><br><span class="line">    change file1 no.3</span><br><span class="line"></span><br><span class="line">commit ef733ffec4e80ed851f353f2d8b2dba46b831bb6</span><br><span class="line">Merge: 5e96765 7d9cebd</span><br><span class="line">Author: kino &lt;kino@gmail.com&gt;</span><br><span class="line">Date:   Thu Nov 24 23:30:29 2022 +0800</span><br><span class="line"></span><br><span class="line">    Merge branch <span class="string">&#x27;feature2&#x27;</span> into feature1</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="comment"># 我们可以直接 git revert 指定的 commit, 例如 上面 merge 的 commit id 是 ef733ffec4e80ed851f353f2d8b2dba46b831bb6</span></span><br><span class="line">$ git revert -i ef733ffec4e80ed851f353f2d8b2dba46b831bb6 -m 1</span><br><span class="line"><span class="comment"># 注意, 已经要加上 -m 1, 否则会报如下错:</span></span><br><span class="line"><span class="comment">#   error: commit ef733ffec4e80ed851f353f2d8b2dba46b831bb6 is a merge but no -m option was given.</span></span><br><span class="line"><span class="comment">#   fatal: revert failed</span></span><br><span class="line"><span class="comment"># 在这里解释下 -m 1 的含义:</span></span><br><span class="line"><span class="comment">#   从上面的 git log 可以看见 &quot;Merge: 5e96765 7d9cebd&quot; 的信息, 这代表着, 本次 merge 是使用当前分支的 5e96765(commit) 和 feature2 分支的 7d9cebd(commit) 合并而来, 我们可以做一下验证:</span></span><br><span class="line"><span class="comment">#     # 首先 cat-file 5e96765</span></span><br><span class="line"><span class="comment">#     $ git cat-file -p 5e96765</span></span><br><span class="line"><span class="comment">#     tree fa6ff2fd55be9834b45f0be9d347b1670594ed17</span></span><br><span class="line"><span class="comment">#     parent d27c172b6e876938eb39094801ca5e436a30b3c3</span></span><br><span class="line"><span class="comment">#     author kino &lt;kino@gmail.com&gt; 1669303829 +0800</span></span><br><span class="line"><span class="comment">#     committer kino &lt;kino@gmail.com&gt; 1669303829 +0800</span></span><br><span class="line"><span class="comment">#     change file1 no.2</span></span><br><span class="line"><span class="comment">#    # 然后取 tree 的 id 继续查看, 可以看到, 这个 tree 记录该 commit 的两个文件</span></span><br><span class="line"><span class="comment">#    $ git cat-file -p fa6ff2fd55be9834b45f0be9d347b1670594ed17</span></span><br><span class="line"><span class="comment">#    100644 blob 4a1ca461271ec4e0041822373470703dca5d0626	file1.txt</span></span><br><span class="line"><span class="comment">#    100644 blob 18ffc0add953f06f00be32437b9f79e09af27d32	file2.txt</span></span><br><span class="line"><span class="comment">#    # 然后取 file2.txt 的 id 继续查看, 可以看到, 这个 tree 记录 该 file2.txt 的内容为: file2 init</span></span><br><span class="line"><span class="comment">#    $ git cat-file -p 18ffc0add953f06f00be32437b9f79e09af27d32</span></span><br><span class="line"><span class="comment">#    file2 init</span></span><br><span class="line"><span class="comment">#    # 然后我们再 cat-file 7d9cebd</span></span><br><span class="line"><span class="comment">#    tree 1b5c42acd113046ec223223affe7b3ef579a293b</span></span><br><span class="line"><span class="comment">#    parent 9acd7882175075c0f3e2f44dfa0d91f3d0a673d1</span></span><br><span class="line"><span class="comment">#    author kino &lt;kino@gmail.com&gt; 1669303829 +0800</span></span><br><span class="line"><span class="comment">#    committer kino &lt;kino@gmail.com&gt; 1669303829 +0800</span></span><br><span class="line"><span class="comment">#    change file2 no.1</span></span><br><span class="line"><span class="comment">#    # 然后取 tree 的 id 继续查看, 可以看到, 这个 tree 记录该 commit 的两个文件</span></span><br><span class="line"><span class="comment">#    git cat-file -p 1b5c42acd113046ec223223affe7b3ef579a293b</span></span><br><span class="line"><span class="comment">#    100644 blob 0c481f7fe4602d041634c353e31846bf1b638c37	file1.txt</span></span><br><span class="line"><span class="comment">#    100644 blob c6b0b29e598db81ef8e54ec955df78cfac4ae316	file2.txt</span></span><br><span class="line"><span class="comment">#    # 然后取 file2.txt 的 id 继续查看, 可以看到, 这个 tree 记录 该 file2.txt 的内容</span></span><br><span class="line"><span class="comment">#    git cat-file -p c6b0b29e598db81ef8e54ec955df78cfac4ae316</span></span><br><span class="line"><span class="comment">#    file2 init</span></span><br><span class="line"><span class="comment">#    add file2.txt code 1</span></span><br><span class="line"><span class="comment"># 由此我们可以得出结论, 5e96765 就是 feature1 在 Merge 之前的状态, 而 7d9cebd 就是 feature2 在 Merge 之前的状态。</span></span><br><span class="line"><span class="comment"># 因为 一个 Merge 记录了两个分支的 commit 信息, 所以, 在 revert merge 的时候,需要明确的支出, 要revert 到哪个commit, 因为我们是想取消 feature2 里面的内容, 所以就是 -m 1 </span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ok, 回到正题, git revert 之后, 我们再查看 log</span></span><br><span class="line">$ git <span class="built_in">log</span> --oneline</span><br><span class="line">b4dde93 (HEAD -&gt; feature1) Revert <span class="string">&quot;Merge branch &#x27;feature2&#x27; into feature1&quot;</span></span><br><span class="line">3e6be92 change file1 no.3</span><br><span class="line">ef733ff Merge branch <span class="string">&#x27;feature2&#x27;</span> into feature1</span><br><span class="line">5e96765 change file1 no.2</span><br><span class="line">7d9cebd (feature2) change file2 no.1</span><br><span class="line">d27c172 change file1 no.1</span><br><span class="line">9acd788 (master) change: add file1 &amp; file2</span><br><span class="line"><span class="comment"># 然后查看 file2.txt</span></span><br><span class="line">$ <span class="built_in">cat</span> file2.txt</span><br><span class="line">file2 init</span><br></pre></td></tr></table></figure></p>
<h1 id="五、git-高级操作"><a href="#五、git-高级操作" class="headerlink" title="五、git 高级操作"></a>五、git 高级操作</h1><h2 id="1-git-撤销操作"><a href="#1-git-撤销操作" class="headerlink" title="1 git 撤销操作"></a>1 git 撤销操作</h2><p><strong>disk</strong></p>
<div class="table-container">
<table>
<thead>
<tr>
<th>command</th>
<th>description</th>
</tr>
</thead>
<tbody>
<tr>
<td>查看修改</td>
<td><code>git diff</code></td>
</tr>
<tr>
<td>查看状态</td>
<td><code>git status</code> -&gt; <code>Changes not staged for comit</code></td>
</tr>
<tr>
<td>撤销文件修改</td>
<td><code>git checkout &lt;change_file&gt;  or git restore &lt;change_file&gt;</code></td>
</tr>
<tr>
<td>提交暂存区</td>
<td>git add <change_file></td>
</tr>
</tbody>
</table>
</div>
<p><strong>暂存区</strong></p>
<div class="table-container">
<table>
<thead>
<tr>
<th>command</th>
<th>description</th>
</tr>
</thead>
<tbody>
<tr>
<td>查看状态</td>
<td><code>git status</code> -&gt; <code>Changes to be committed(绿色)</code></td>
</tr>
<tr>
<td>从暂存区移除，但保留硬盘上的修改</td>
<td><code>git reset &lt;change_file&gt;</code> or <code>git restore --staged &lt;change_file&gt;</code></td>
</tr>
<tr>
<td>从暂存区移除，不保留硬盘上的修改</td>
<td><code>git checkout HEAD &lt;change_file&gt;</code></td>
</tr>
<tr>
<td>提交本地git</td>
<td><code>git commit</code></td>
</tr>
</tbody>
</table>
</div>
<p><strong>local</strong></p>
<div class="table-container">
<table>
<thead>
<tr>
<th>command</th>
<th>description</th>
</tr>
</thead>
<tbody>
<tr>
<td>撤销commit(保留磁盘上的修改和暂存区记录)</td>
<td><code>git reset --soft HEAD~1</code></td>
</tr>
<tr>
<td>撤销commit(清除暂存区记录, 只保留磁盘上的修改)</td>
<td><code>git reset HEAD~1</code> == <code>git reset --mixed HEAS~1</code></td>
</tr>
<tr>
<td>撤销commit(清除暂存区记录, 清除磁盘上的修改)</td>
<td><code>git reset --hard HEAD~1</code></td>
</tr>
<tr>
<td>生成新的<code>commitId</code>,将上一个<code>commit+</code>的内容变成<code>commit-</code></td>
<td><code>git revert HEAD</code></td>
</tr>
<tr>
<td>提交远端git</td>
<td><code>git push</code></td>
</tr>
</tbody>
</table>
</div>
<p><code>git reset</code> &amp; <code>git revert</code>:</p>
<ol>
<li><code>git reset</code>: 只能回到之前某一个commit的状态。</li>
<li><code>git revert</code>:撤销中间任意一个commit。<code>git revert 70a0;(git revert HEAD~1)</code></li>
</ol>
<p>如果操作项目的分支是公共分支，只能通过 <code>git revert</code> 生成一个新的 commitId，从这个结果上撤销我们之前的修改。</p>
<ol>
<li><code>git revert HEAD</code></li>
<li><code>git push</code></li>
</ol>
<p>如果操作项目的分支是个人分支，可以通过<code>git reset</code>撤销我们之前的修改</p>
<ol>
<li><code>git reset --hard HEAD~1</code></li>
<li><code>git push -f</code></li>
</ol>
<h2 id="2-git-找回丢失文件-commit了"><a href="#2-git-找回丢失文件-commit了" class="headerlink" title="2 git 找回丢失文件(commit了)"></a>2 git 找回丢失文件(commit了)</h2><p>恢复因为执行 <code>git reset --hard COMMITID</code> 丢失的文件<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 重新创建一个项目</span></span><br><span class="line">$ <span class="built_in">cd</span> .. &amp;&amp; <span class="built_in">rm</span> -rf git-study &amp;&amp; <span class="built_in">mkdir</span> git-study &amp;&amp; <span class="built_in">cd</span> git-study &amp;&amp; git init</span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">&#x27;master message 1&#x27;</span> &gt;&gt; master_1.txt</span><br><span class="line">$ git add master_1.txt</span><br><span class="line">$ git commit -m <span class="string">&#x27;first commit&#x27;</span></span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">&#x27;master message 2&#x27;</span> &gt;&gt; master_2.txt</span><br><span class="line">$ git add master_2.txt</span><br><span class="line">$ git commit -m <span class="string">&#x27;No.2 commit&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 在这两次commit的基础上, reset 到第一次(first commit)上</span></span><br><span class="line">$ git <span class="built_in">log</span>   <span class="comment"># 获取第一次commitid</span></span><br><span class="line">$ git reset --hard 4a9bcb880db85a1ca77807dea9b3adce29dc4fda</span><br><span class="line"><span class="comment"># 再次查看 log 信息, 此时可以看见只有一次commit了, 第二次 commit(No.2 commit) 已经丢失</span></span><br><span class="line">$ git <span class="built_in">log</span> -n 2</span><br></pre></td></tr></table></figure><br>git 提供了 <code>git reflog</code> 用来记录你的每一次改变目录树的命令，使用好他就可以很方便的恢复你的提交：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">4a9bcb8 (HEAD -&gt; master) HEAD@&#123;0&#125;: reset: moving to 4a9bcb880db85a1ca77807dea9b3adce29dc4fda</span><br><span class="line">80258ce HEAD@&#123;1&#125;: commit: No.2 commit</span><br><span class="line">4a9bcb8 (HEAD -&gt; master) HEAD@&#123;2&#125;: commit (initial): first commit</span><br></pre></td></tr></table></figure><br>可以看到最上面一条记录是将 HEAD 重新指向第一次的commit了, 同时也有显示第二次 commit 的 commitid, 有了这个 commitid, 就可以回滚了。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">$ git reset --hard 80258ce</span><br><span class="line">HEAD is now at 80258ce No.2 commit</span><br><span class="line">$ git <span class="built_in">log</span></span><br><span class="line">commit 80258ce0146f373d15a1991d61af4061687782bc (HEAD -&gt; master)</span><br><span class="line">Author: kino &lt;kino@gmail.com&gt;</span><br><span class="line">Date:   Thu Nov 24 02:26:10 2022 +0800</span><br><span class="line"></span><br><span class="line">    No.2 commit</span><br><span class="line"></span><br><span class="line">commit 4a9bcb880db85a1ca77807dea9b3adce29dc4fda</span><br><span class="line">Author: kino &lt;kino@gmail.com&gt;</span><br><span class="line">Date:   Thu Nov 24 02:25:06 2022 +0800</span><br><span class="line"></span><br><span class="line">    first commit</span><br></pre></td></tr></table></figure><br>可以看到, commit 已被找回.</p>
<p>但是通常情况下, 可能会出现在 <code>git reset</code> 之后, 还有新的 commit, 如果直接 <code>reset</code> 恢复的 commit, 肯定会造成新的 commit 又丢失, 所以如果我们只是想恢复这个一个 commit, 可以使用 <code>git cherry-pick commitid</code> 来单独将这个 commitid 恢复到当前分支或者用 <code>git merge</code> 来做合并<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">$ git cherry-pick 04b0396</span><br><span class="line">[master fbf401a] No.2 commit</span><br><span class="line"> Date: Thu Nov 24 02:38:14 2022 +0800</span><br><span class="line"> 1 file changed, 1 insertion(+)</span><br><span class="line"> create mode 100644 master_2.txt</span><br><span class="line"> </span><br><span class="line">$ git <span class="built_in">log</span></span><br><span class="line">commit fbf401a96bd9831c18ed02e9ee852cef8111ccb1 (HEAD -&gt; master)</span><br><span class="line">Author: kino &lt;kino@gmail.com&gt;</span><br><span class="line">Date:   Thu Nov 24 02:38:14 2022 +0800</span><br><span class="line"></span><br><span class="line">    No.2 commit</span><br><span class="line"></span><br><span class="line">commit 1b5bfdb36ad01fb86d94b76654347f5de5475f37</span><br><span class="line">Author: kino &lt;kino@gmail.com&gt;</span><br><span class="line">Date:   Thu Nov 24 02:38:05 2022 +0800</span><br><span class="line"></span><br><span class="line">    first commit</span><br></pre></td></tr></table></figure></p>
<h2 id="3-git-找回丢失文件-未commit-但添加暂存区了"><a href="#3-git-找回丢失文件-未commit-但添加暂存区了" class="headerlink" title="3 git 找回丢失文件(未commit,但添加暂存区了)"></a>3 git 找回丢失文件(未commit,但添加暂存区了)</h2><p>如果只 <code>git add</code> 了没有 <code>git commit</code>(如果连 <code>git add</code>都没有, 那只能找磁盘数据恢复的方式了), 这就不是仅仅一个 <code>git reflog</code> 就能找回的了。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> .. &amp;&amp; <span class="built_in">rm</span> -rf git-study &amp;&amp; <span class="built_in">mkdir</span> git-study &amp;&amp; <span class="built_in">cd</span> git-study &amp;&amp; git init</span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">&#x27;master message 1&#x27;</span> &gt;&gt; master_1.txt</span><br><span class="line">$ git add master_1.txt</span><br><span class="line">$ git commit -m <span class="string">&#x27;first commit&#x27;</span></span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">&#x27;master message 2&#x27;</span> &gt;&gt; master_2.txt</span><br><span class="line">$ git add master_2.txt</span><br><span class="line">$ git commit -m <span class="string">&#x27;No.2 commit&#x27;</span></span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">&#x27;master message 3&#x27;</span> &gt;&gt; master_3.txt</span><br><span class="line">$ git add .</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看 log</span></span><br><span class="line">$ git <span class="built_in">log</span> -n 2</span><br><span class="line"><span class="comment"># 取最新的一次 commit id</span></span><br><span class="line">$ git reset --hard ee614a48f753479a111723ae7ad926e0750ffa6c</span><br><span class="line"><span class="comment"># 查看 status</span></span><br><span class="line">$ git status </span><br><span class="line">On branch master</span><br><span class="line">nothing to commit, working tree clean</span><br><span class="line"><span class="comment"># 查看本地文件</span></span><br><span class="line">total 16</span><br><span class="line">-rw-r--r--  1 kino  staff    17B 11 24 02:43 master_1.txt</span><br><span class="line">-rw-r--r--  1 kino  staff    17B 11 24 02:43 master_2.txt</span><br><span class="line"><span class="comment"># 可以看见文件已经丢了</span></span><br></pre></td></tr></table></figure><br>git 提供了 <code>git fsck --lost-found</code> 命令, 他会通过一些神奇的方式把历史操作过的文件以某种算法算出来加到.git/lost-found文件夹里，输出的记录就像下面这个样子。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">❯ git fsck --lost-found</span><br><span class="line">Checking object directories: 100% (256/256), <span class="keyword">done</span>.</span><br><span class="line">dangling blob adbd4c8bf64367fb685336a67f02c5716dc47d73</span><br></pre></td></tr></table></figure><br>这里返回的第一行带有 <code>blob</code> 的信息，我们可以用 <code>git show</code>来查看里面的内容<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ git show adbd4c8bf64367fb685336a67f02c5716dc47d73</span><br><span class="line">master message 3</span><br><span class="line"></span><br><span class="line"><span class="comment"># 比如可以将内容追加到新文件中 </span></span><br><span class="line">$ git show adbd4c8bf64367fb685336a67f02c5716dc47d73 &gt; master_3.txt</span><br></pre></td></tr></table></figure></p>
<p>小记: 如果你的提交记录多的话, <code>git fsck --lost-found</code> 可以看见很多内容, 如下<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">$ git fsck --lost-found</span><br><span class="line">Checking object directories: 100% (256/256), <span class="keyword">done</span>.</span><br><span class="line">Checking objects: 100% (35559/35559), <span class="keyword">done</span>.</span><br><span class="line">dangling blob 601e8abff177a0b2f8a31944654c0cdf0dd1f197</span><br><span class="line">dangling tree 6c247c35ae51aa86736f745802bb59b97b6598ee</span><br><span class="line">dangling blob 7a379e6f07391f3bca1fbcc076fcde8f719ffb69</span><br><span class="line">dangling blob c66fa02bf74853789b63615a80998b3fbd3d8823</span><br><span class="line">dangling blob 4996ec43a907f8f6312c3bf137e2f76c7f4c9c9c</span><br><span class="line">dangling commit 69a110054ca792e6b1060d20ec24ddc9710ada4d</span><br><span class="line">dangling blob 87ed1263b56d0a98cd163440f872f135a34b61da</span><br><span class="line">dangling blob aff0bc224d142929e3f82b8855dd1e97d8b3635b</span><br><span class="line">dangling blob eef114f8614a15a11ccfbb7cf5e34302072176e1</span><br><span class="line">dangling blob b50db5dad43e13fde45141039f684be48e293739</span><br><span class="line">dangling blob 820f0136b61394e482fd18e28a7ba81fbb31f688</span><br><span class="line">dangling blob 2d26cd809139b86218d3460c85baed90d018f007</span><br><span class="line">dangling blob 603ca9d770947939d8da7ff3aef3775bb27c427e</span><br><span class="line">dangling blob e54821ed942c6582d01f60b6715e16301cdcfc4d</span><br><span class="line">dangling blob e06be73bb272c7837ab38226c1c1bb13f845574e</span><br><span class="line">dangling blob 399aede4e687465bf7c895251bef685b0de089b6</span><br><span class="line">dangling blob 5ea2239d63a9a119a54a52fde6ebf208a940832a</span><br><span class="line">dangling blob 35ab95c7faf42b7dbbf4e0992527c719ffd4acbd</span><br><span class="line">dangling blob 9bb609de693b78eb1dc0e3dca7a9d684effd3f4a</span><br><span class="line">dangling blob aac499592477199b2630791aecde2db8a608dfa9</span><br><span class="line">dangling commit 10c581dcdf08ea1bed594a359e09698afd4f794e</span><br><span class="line">dangling blob 06eb7790a9f71bf796749940102030c6e9503022</span><br></pre></td></tr></table></figure><br>可以看到这里有<code>blob</code>、<code>commit</code>、<code>tree</code>类型的数据，其实还有<code>tag</code>等类型的, 这里需要了解下 git 的底层存储</p>
<ul>
<li><code>commit</code> 数据结构在每次提交之后都会生成一个, 当我们进行 <code>commit</code> 之后, 首先会创建一个 <code>commit</code> 组件, 之后创建一个 <code>tree</code> 组件, 把所有的文件信息都存在里面, 每个 <code>blob</code> 都代表一个文件, 都可以在 <code>tree</code> 里面找到。</li>
<li><code>blob</code> 组件并不会对文件信息进行存储, 而是只对文件的内容进行记录, 文件信息存储在 <code>tree</code> 里.</li>
</ul>
<h2 id="4-终极大招"><a href="#4-终极大招" class="headerlink" title="4 终极大招"></a>4 终极大招</h2><p>如果 5.3 并没有找到你想要的内容, 那只能再去看看最近修改的文件了<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ find .git/objects -<span class="built_in">type</span> f | xargs <span class="built_in">ls</span> -lt | sed 3q</span><br><span class="line">-r--r--r--  1 kino  staff   33 11 24 02:43 .git/objects/ad/bd4c8bf64367fb685336a67f02c5716dc47d73</span><br><span class="line">-r--r--r--  1 kino  staff   33 11 24 02:43 .git/objects/cc/6e4eeea4f70e784fade7a18bdba6c28f7642e8</span><br><span class="line">-r--r--r--  1 kino  staff   33 11 24 02:43 .git/objects/24/b6cb352efeff7a2b24b99e8ff814ab1fc2a2fd</span><br></pre></td></tr></table></figure><br>使用 <code>git cat-file -t commitid</code> 可以看见是什么类型的<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ git cat-file -t adbd4c8bf64367fb685336a67f02c5716dc47d73</span><br><span class="line">blob</span><br><span class="line"></span><br><span class="line">$ git cat-file -t cc6e4eeea4f70e784fade7a18bdba6c28f7642e8</span><br><span class="line">blob</span><br><span class="line"></span><br><span class="line">$ git cat-file -t 24b6cb352efeff7a2b24b99e8ff814ab1fc2a2fd</span><br><span class="line">blob</span><br></pre></td></tr></table></figure><br>再使用 <code>git cat-file -p commitid</code> 查看内容<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ git cat-file -p adbd4c8bf64367fb685336a67f02c5716dc47d73</span><br><span class="line">master message 3</span><br><span class="line"></span><br><span class="line">$ git cat-file -p cc6e4eeea4f70e784fade7a18bdba6c28f7642e8</span><br><span class="line">master message 2</span><br><span class="line"></span><br><span class="line">$ git cat-file -p 24b6cb352efeff7a2b24b99e8ff814ab1fc2a2fd</span><br><span class="line">master message 1</span><br></pre></td></tr></table></figure></p>
<h2 id="5-git-迁移-保留-commit"><a href="#5-git-迁移-保留-commit" class="headerlink" title="5 git 迁移(保留 commit)"></a>5 git 迁移(保留 commit)</h2><h3 id="5-1-clone-原来的项目"><a href="#5-1-clone-原来的项目" class="headerlink" title="5.1 clone 原来的项目"></a>5.1 clone 原来的项目</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">clone</span> --bare git://github.com/username/project.git</span><br></pre></td></tr></table></figure>
<h3 id="5-2-推送到新的gitlab"><a href="#5-2-推送到新的gitlab" class="headerlink" title="5.2 推送到新的gitlab"></a>5.2 推送到新的gitlab</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> project</span><br><span class="line">$ git push --mirror git@example.com/username/newproject.git</span><br></pre></td></tr></table></figure>
<p>会提示没有权限, 在gitlab中把项目的权限保护关掉就好了</p>
<h3 id="5-3-本地代码更换gitlab地址"><a href="#5-3-本地代码更换gitlab地址" class="headerlink" title="5.3 本地代码更换gitlab地址"></a>5.3 本地代码更换gitlab地址</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git remote set-url origin git@example.com/username/newproject.git</span><br></pre></td></tr></table></figure>

    
  </div>

  
  <!-- Post Copyright -->

<div class="post-copyright">
  <p class="copyright-item">
    <span>Author: </span>
    <a href="https://stardustorz.github.io">draco</a>
  </p>
  <p class="copyright-item">
    <span>Link: </span>
    <a href="https://stardustorz.github.io/2021/06/12/Basic/git%E5%B8%B8%E7%94%A8%E6%93%8D%E4%BD%9C/">https://stardustorz.github.io/2021/06/12/Basic/git%E5%B8%B8%E7%94%A8%E6%93%8D%E4%BD%9C/</a>
  </p>
  <p class="copyright-item">
    <span>License: </span>
    
    <a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/" target="_blank">知识共享署名-非商业性使用 4.0 国际许可协议</a>
  </p>
</div>

    

  

  
  <footer class="post-footer">
    
    <div class="post-tags">
      
      <a href="/tags/Git/">Git</a>
      
    </div>
    
      
  <nav class="post-nav">  
      
      <a class="prev" href="/2021/06/12/Algorithm/Tree/">  
        <i class="iconfont icon-left"></i>  
        <span class="prev-text nav-default">[Algorithm] Tree</span>  
        <span class="prev-text nav-mobile">Prev</span>  
      </a>  
      
      
  </nav>  
  

  </footer>
  

</article>
        </div>
      </div>
    </main>
    <footer id="footer" class="footer">
      <!-- Social Links -->

<div class="social-links">
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  

  
  <a href="/atom.xml" class="iconfont icon-rss" title="rss"></a>
  
</div>



<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme -
    <a class="theme-link" target="_blank" rel="noopener" href="https://github.com/ahonn/hexo-theme-even">Even</a>
  </span>
  <span class="division">|</span>
  <span class="hosting-info">
    footer.hosting
  </span>

  <span class="copyright-year">
    <span>
      
      &copy;
      
      2019 - 2025      
    </span>

    <span class="heart">
      <i class="iconfont icon-heart"></i>
    </span>

    <span class="author">draco</span>
  </span>

</div>
    </footer>
    <div class="back-to-top" id="back-to-top"> <i class="iconfont icon-up"></i> </div>
  </div>
  







<script type="text/javascript" src="/lib/jquery/jquery.min.js"></script>



<script type="text/javascript" src="/lib/slideout/slideout.js"></script>



<script type="text/javascript" src="/lib/fancybox/jquery.fancybox.pack.js"></script>



  <script type="text/javascript" src="/js/src/even.js?v=3.0.0"></script>
</body>

</html>